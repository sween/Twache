<?xml version="1.0" encoding="UTF-8"?>
<Export generator="Cache" version="22" zv="Cache for Windows (x86-32) 2008.2 (Build 526U)" ts="2009-07-16 21:30:38">
<Class name="Ensemblisms.Episode4.Twitter">
<Description>
Ensemblisms Episode IV, A Simple Twitter Utility.
Ron Sweeney, 07/05/2009
Woot, have fun.
This Class is shared without any warranty written or implied.</Description>
<IncludeCode>%occXSLT</IncludeCode>
<Super>%RegisteredObject,%XML.Adaptor</Super>
<TimeChanged>61558,77315.795012</TimeChanged>
<TimeCreated>61556,60350.705138</TimeCreated>

<Method name="SendTweet">
<ClassMethod>1</ClassMethod>
<FormalSpec>Credential:%String,Tweet:%String</FormalSpec>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
	
	Set sc = $$$OK
	
			Set responseStream = ##class(%Stream.GlobalBinary).%New()
			set cred = ##class(Ens.Config.Credentials).%OpenId(Credential)
		
			Set request = ##class(%Net.HttpRequest).%New()
			Set request.Server = "twitter.com"
			Set request.Port = "80"
			
			// Here lets rip apart the Credentials Object
			Set request.Username = cred.Username
			Set request.Password = cred.Password
			

			Set requestStream = ##class(%GlobalBinaryStream).%New()	
    		
    		
            Set tweetstatus = Tweet 
            
            /// "Testing the Object Script Method"
              
            Do request.SetParam("status",tweetstatus) 
            Set request.EntityBody = requestStream
			Set request.ContentType = "text/xml"
	
		
			// Post the Tweet to Twitter
			Set sc = request.Post("/statuses/update.xml")			
			Quit:$System.Status.IsError(sc)
			
			Set sc = responseStream.CopyFrom(request.HttpResponse.Data)
            Quit:$System.Status.IsError(sc)
            
          
            
			Set sc = ##class(%XML.XPATH.Document).CreateFromStream(responseStream, .xmlDoc)	
			Quit:$System.Status.IsError(sc)
			
			
			
			Set response = request.HttpResponse.Data.Read()
			
			Set blar = xmlDoc.EvaluateExpression("/","/status/text/text()", .results)
			
			
		    
				
						If $IsObject(results) {
										
								Set tresponse = results.GetAt(1)
										
																
						}
						
						If ( tresponse.Value = Tweet ) {
							
								Set sc = $$$OK
								w tresponse.Value
						
							
						}
						
						else {
							
								Quit:$System.Status.IsError(sc)
							
							
						}
	
			Quit sc
]]></Implementation>
</Method>

<UDLText name="T">
<Content><![CDATA[
//

]]></Content>
</UDLText>

<UDLText name="T">
<Content><![CDATA[
//

]]></Content>
</UDLText>

<UDLText name="T">
<Content><![CDATA[
//

]]></Content>
</UDLText>

<Method name="FriendsTimeline">
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
	
	//http://twitter.com/statuses/friends_timeline.xml
]]></Implementation>
</Method>
</Class>
</Export>
